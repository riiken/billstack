<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BillStack - GST Invoice Generator</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body class="loading">
  <div class="container">
    <!-- Header -->
    <header class="header">
      <h1>üìä BillStack</h1>
      <div class="header-actions">
        <button id="settingsBtn" class="icon-btn" title="Settings">‚öôÔ∏è</button>
        <button id="historyBtn" class="icon-btn" title="History">üìã</button>
      </div>
    </header>

    <!-- Main Form -->
    <div id="mainForm" class="main-content">
      <!-- Invoice Details -->
      <section class="section">
        <h2>Invoice Details</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="invoiceNumber">Invoice Number</label>
            <input type="text" id="invoiceNumber" value="INV-001" required>
          </div>
          <div class="form-group">
            <label for="invoiceDate">Date</label>
            <input type="date" id="invoiceDate" required>
          </div>
        </div>
        <div class="form-group">
          <label for="dueDate">Due Date</label>
          <input type="date" id="dueDate" required>
        </div>
      </section>

      <!-- Your Business Details -->
      <section class="section">
        <h2>Your Business Details</h2>
        <div class="info-box" id="businessInfo">
          <p class="setup-prompt">‚ö†Ô∏è Please set up your business details in Settings first</p>
        </div>
      </section>

      <!-- Client Details -->
      <section class="section">
        <div class="section-header">
          <h2>Client Details</h2>
        </div>

        <!-- Client Templates -->
        <div class="form-group" style="background: #f3f4f6; padding: 12px; border-radius: 6px; margin-bottom: 16px;">
          <label for="loadClientTemplate" style="margin-bottom: 8px;">Load Saved Client</label>
          <div style="display: flex; gap: 8px; align-items: center;">
            <select id="loadClientTemplate" style="flex: 1;">
              <option value="">-- Select a client --</option>
            </select>
            <button id="saveClientTemplateBtn" class="btn-secondary" style="white-space: nowrap; padding: 8px 12px;" title="Save current client as template">üíæ Save</button>
            <button id="deleteClientTemplateBtn" class="btn-secondary" style="white-space: nowrap; padding: 8px 12px; background: #fee2e2; color: #dc2626; display: none;" title="Delete selected client template">üóëÔ∏è</button>
          </div>
          <small style="color: #6b7280; display: block; margin-top: 6px;">Save frequent clients for quick reuse</small>
        </div>

        <div class="form-group" id="clientNameGroup">
          <label for="clientName">Client Name *</label>
          <input type="text" id="clientName" placeholder="Client or Company Name" required>
          <span class="error-message">Client name is required</span>
        </div>
        <div class="form-group" id="clientGSTINGroup">
          <label for="clientGSTIN">Client GSTIN (Optional)</label>
          <input type="text" id="clientGSTIN" placeholder="29XXXXX1234X1ZX" pattern="[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}">
          <small>Leave empty for B2C transactions</small>
          <span class="error-message">Invalid GSTIN format (e.g., 29ABCDE1234F1Z5)</span>
        </div>
        <div class="form-group" id="clientStateGroup">
          <label for="clientState">Client State *</label>
          <select id="clientState" required>
            <option value="">Select State</option>
            <option value="AN">Andaman and Nicobar Islands</option>
            <option value="AP">Andhra Pradesh</option>
            <option value="AR">Arunachal Pradesh</option>
            <option value="AS">Assam</option>
            <option value="BR">Bihar</option>
            <option value="CH">Chandigarh</option>
            <option value="CG">Chhattisgarh</option>
            <option value="DN">Dadra and Nagar Haveli</option>
            <option value="DD">Daman and Diu</option>
            <option value="DL">Delhi</option>
            <option value="GA">Goa</option>
            <option value="GJ">Gujarat</option>
            <option value="HR">Haryana</option>
            <option value="HP">Himachal Pradesh</option>
            <option value="JK">Jammu and Kashmir</option>
            <option value="JH">Jharkhand</option>
            <option value="KA">Karnataka</option>
            <option value="KL">Kerala</option>
            <option value="LA">Ladakh</option>
            <option value="LD">Lakshadweep</option>
            <option value="MP">Madhya Pradesh</option>
            <option value="MH">Maharashtra</option>
            <option value="MN">Manipur</option>
            <option value="ML">Meghalaya</option>
            <option value="MZ">Mizoram</option>
            <option value="NL">Nagaland</option>
            <option value="OR">Odisha</option>
            <option value="PY">Puducherry</option>
            <option value="PB">Punjab</option>
            <option value="RJ">Rajasthan</option>
            <option value="SK">Sikkim</option>
            <option value="TN">Tamil Nadu</option>
            <option value="TS">Telangana</option>
            <option value="TR">Tripura</option>
            <option value="UP">Uttar Pradesh</option>
            <option value="UK">Uttarakhand</option>
            <option value="WB">West Bengal</option>
          </select>
        </div>
        <div class="form-group">
          <label for="clientAddress">Client Address</label>
          <textarea id="clientAddress" rows="3" placeholder="Full address with pincode"></textarea>
        </div>
        <div class="form-group">
          <label for="clientEmail">Client Email</label>
          <input type="email" id="clientEmail" placeholder="client@example.com">
        </div>
      </section>

      <!-- Invoice Items -->
      <section class="section">
        <div class="section-header">
          <h2>Invoice Items</h2>
          <button id="addItemBtn" class="btn-secondary">+ Add Item</button>
        </div>
        <div id="itemsList">
          <!-- Items will be added here dynamically -->
        </div>
      </section>

      <!-- Totals -->
      <section class="section">
        <div class="totals-box">
          <div class="total-row">
            <span>Subtotal:</span>
            <span id="subtotal">‚Çπ0.00</span>
          </div>
          <div class="total-row tax-row" id="cgstRow" style="display: none;">
            <span>CGST @ 9%:</span>
            <span id="cgst">‚Çπ0.00</span>
          </div>
          <div class="total-row tax-row" id="sgstRow" style="display: none;">
            <span>SGST @ 9%:</span>
            <span id="sgst">‚Çπ0.00</span>
          </div>
          <div class="total-row tax-row" id="igstRow" style="display: none;">
            <span>IGST @ 18%:</span>
            <span id="igst">‚Çπ0.00</span>
          </div>
          <div class="total-row total-main">
            <span>TOTAL:</span>
            <span id="total">‚Çπ0.00</span>
          </div>
          <div class="amount-words" id="amountWords"></div>
        </div>
      </section>

      <!-- Actions -->
      <div class="actions">
        <button id="saveDraftBtn" class="btn-secondary">Save Draft</button>
        <button id="generatePdfBtn" class="btn-primary">Generate PDF</button>
      </div>

      <!-- Auto-save indicator -->
      <div id="autoSaveIndicator" style="text-align: center; margin-top: 12px; font-size: 12px; color: #6b7280; opacity: 0; transition: opacity 0.3s;">
        üíæ Draft auto-saved
      </div>

      <!-- Usage Counter (Free Tier) -->
      <div id="usageCounter" class="usage-counter">
        <span id="usageText">0 of 5 invoices used this month</span>
        <button id="upgradeBtn" class="btn-upgrade" style="display: none;">Upgrade to Pro</button>
      </div>

      <!-- Keyboard Shortcuts Help -->
      <div style="margin-top: 16px; padding: 12px; background: #f9fafb; border-radius: 6px; font-size: 11px; color: #6b7280;">
        <details>
          <summary style="cursor: pointer; font-weight: 600; margin-bottom: 8px;">‚å®Ô∏è Keyboard Shortcuts</summary>
          <div style="display: grid; grid-template-columns: auto 1fr; gap: 4px 12px; margin-top: 8px;">
            <kbd style="background: white; padding: 2px 6px; border: 1px solid #d1d5db; border-radius: 3px; font-size: 10px;">Ctrl/‚åò S</kbd>
            <span>Save Draft</span>

            <kbd style="background: white; padding: 2px 6px; border: 1px solid #d1d5db; border-radius: 3px; font-size: 10px;">Ctrl/‚åò G</kbd>
            <span>Generate PDF</span>

            <kbd style="background: white; padding: 2px 6px; border: 1px solid #d1d5db; border-radius: 3px; font-size: 10px;">Ctrl/‚åò H</kbd>
            <span>Open History</span>

            <kbd style="background: white; padding: 2px 6px; border: 1px solid #d1d5db; border-radius: 3px; font-size: 10px;">Ctrl/‚åò I</kbd>
            <span>Add Item</span>

            <kbd style="background: white; padding: 2px 6px; border: 1px solid #d1d5db; border-radius: 3px; font-size: 10px;">Ctrl/‚åò ,</kbd>
            <span>Settings</span>

            <kbd style="background: white; padding: 2px 6px; border: 1px solid #d1d5db; border-radius: 3px; font-size: 10px;">Esc</kbd>
            <span>Go Back</span>
          </div>
        </details>
      </div>
    </div>

    <!-- Settings View (Hidden by default) -->
    <div id="settingsView" class="settings-view" style="display: none;">
      <div class="settings-header">
        <button id="backBtn" class="icon-btn">‚Üê Back</button>
        <h2>Business Settings</h2>
      </div>

      <div class="settings-content">
        <div class="form-group">
          <label for="businessName">Business/Your Name *</label>
          <input type="text" id="businessName" required>
        </div>

        <div class="form-group">
          <label for="businessGSTIN">Your GSTIN *</label>
          <input type="text" id="businessGSTIN" pattern="[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}" required>
          <small>Format: 29XXXXX1234X1ZX</small>
        </div>

        <div class="form-group">
          <label for="businessState">Your State *</label>
          <select id="businessState" required>
            <option value="">Select State</option>
            <option value="AN">Andaman and Nicobar Islands</option>
            <option value="AP">Andhra Pradesh</option>
            <option value="AR">Arunachal Pradesh</option>
            <option value="AS">Assam</option>
            <option value="BR">Bihar</option>
            <option value="CH">Chandigarh</option>
            <option value="CG">Chhattisgarh</option>
            <option value="DN">Dadra and Nagar Haveli</option>
            <option value="DD">Daman and Diu</option>
            <option value="DL">Delhi</option>
            <option value="GA">Goa</option>
            <option value="GJ">Gujarat</option>
            <option value="HR">Haryana</option>
            <option value="HP">Himachal Pradesh</option>
            <option value="JK">Jammu and Kashmir</option>
            <option value="JH">Jharkhand</option>
            <option value="KA">Karnataka</option>
            <option value="KL">Kerala</option>
            <option value="LA">Ladakh</option>
            <option value="LD">Lakshadweep</option>
            <option value="MP">Madhya Pradesh</option>
            <option value="MH">Maharashtra</option>
            <option value="MN">Manipur</option>
            <option value="ML">Meghalaya</option>
            <option value="MZ">Mizoram</option>
            <option value="NL">Nagaland</option>
            <option value="OR">Odisha</option>
            <option value="PY">Puducherry</option>
            <option value="PB">Punjab</option>
            <option value="RJ">Rajasthan</option>
            <option value="SK">Sikkim</option>
            <option value="TN">Tamil Nadu</option>
            <option value="TS">Telangana</option>
            <option value="TR">Tripura</option>
            <option value="UP">Uttar Pradesh</option>
            <option value="UK">Uttarakhand</option>
            <option value="WB">West Bengal</option>
          </select>
        </div>

        <div class="form-group">
          <label for="businessAddress">Your Address *</label>
          <textarea id="businessAddress" rows="3" required></textarea>
        </div>

        <div class="form-group">
          <label for="businessEmail">Your Email</label>
          <input type="email" id="businessEmail">
        </div>

        <div class="form-group">
          <label for="businessPhone">Your Phone</label>
          <input type="tel" id="businessPhone" placeholder="+91-9876543210">
        </div>

        <div class="form-group">
          <label for="invoicePrefix">Invoice Number Prefix</label>
          <input type="text" id="invoicePrefix" value="INV" maxlength="10">
        </div>

        <div class="form-group">
          <label for="paymentTerms">Default Payment Terms (Days)</label>
          <select id="paymentTerms">
            <option value="7">Net 7 days</option>
            <option value="15" selected>Net 15 days</option>
            <option value="30">Net 30 days</option>
            <option value="45">Net 45 days</option>
          </select>
        </div>

        <button id="saveSettingsBtn" class="btn-primary">Save Settings</button>
      </div>
    </div>

    <!-- History View (Hidden by default) -->
    <div id="historyView" class="history-view" style="display: none;">
      <div class="settings-header">
        <button id="backFromHistoryBtn" class="icon-btn">‚Üê Back</button>
        <h2>Invoice History</h2>
      </div>

      <div id="historyList" class="history-list">
        <p class="empty-state">No invoices generated yet</p>
      </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast" class="toast"></div>
  </div>

  <!-- Libraries -->
  <script src="../../libs/jspdf.umd.min.js"></script>

  <!-- Main Script -->
  <script src="popup.js"></script>
</body>
</html>
